$(function(){var a,t="",e="",l="",i=window.location.pathname,o=(new Date).toLocaleTimeString().slice(0,8).replace(/:/g,"").split(" ").join("")+(new Date).toISOString().slice(0,10).replace(/-/g,""),s=["pdf","doc","docx","jpg","jpeg"];function d(t,e,l){$.ajax({url:t,data:l,method:e,dataType:"json",global:!1,async:!1,beforeSend:function(){$("#loading-indicator").fadeIn("slow")},complete:function(){$("#loading-indicator").fadeOut("slow")},success:function(t){a=t}})}function n(){$(":input").each(function(){var a=this.type;this.tagName.toLowerCase();"text"!=a&&"email"!=a||(this.value="")}),$("#upload_image").val(""),$("#blah").attr("src","img/picture.jpg"),t="",e="",l=""}function r(t){"success"==t&&($("#myAlert2").attr("class","alert alert-success alert-dismissable center-alert"),$("#closeAlrt").attr("class","btn btn-sm btn-outline-success my-2 my-sm-0"),$("#alertMssg").text(a.status),$("#alertModal").modal("show"),$("#ModalInput").modal("hide"),$("#closeAlrt").on("click",function(){window.location.reload()})),"failed"==t&&($("#myAlert2").attr("class","alert alert-warning alert-dismissable center-alert"),$("#closeAlrt").attr("class","btn btn-sm btn-outline-warning my-2 my-sm-0"),$("#alertMssg").text(a.message),$("#alertModal").modal("show"),$("#ModalInput").modal("hide"),$("#closeAlrt").on("click",function(){window.location.reload()})),"error"==t&&($("#myAlert2").attr("class","alert alert-danger alert-dismissable center-alert"),$("#closeAlrt").attr("class","btn btn-sm btn-outline-danger my-2 my-sm-0"),$("#alertMssg").text(a.message),$("#alertModal").modal("show"))}$("#btnCloseInput").on("click",function(){n(),$("#checkBtn").hide()}),$("#btnXInput").on("click",function(){n(),$("#checkBtn").hide()}),$("#ModalInput").modal({show:!1,backdrop:"static"}),$("#uploadimageModal").modal({show:!1,backdrop:"static"}),$("#ModalDetails").modal({show:!1,backdrop:"static"}),$("#alert").hide(),$(document).ajaxSend(function(a,t,e){$("#loading-indicator").fadeIn("slow")}),$(document).ajaxComplete(function(a,t,e){$("#loading-indicator").fadeOut("slow")}),$image_crop=$("#image_demo").croppie({enableExif:!0,viewport:{width:240,height:240,type:"square"},boundary:{width:300,height:300}}),$("#upload_image").on("change",function(){var a,t,i;files=this.files,files&&files[0]?(e=files[0].name.split(".").slice(0,-1).join("."),l=files[0].name.split(".").pop().toLowerCase(),isSuccess=s.indexOf(l)>-1,$("#uploadId").val(files[0].name),isSuccess?files[0].size<=2e6?($("#uploadimageModal").modal("show"),$("#ModalInput").modal("hide"),a=this.files[0],t=function(a){$("#blah").attr("src",a.target.result),$("#uploadimageModal").modal("show"),$image_crop.croppie("bind",{url:event.target.result})},(i=new FileReader).onload=t,i.readAsDataURL(a)):(alert("Select file size under 2MB"),$("#upload_image").val("")):(alert("Select valid file type '.jpg' & 'jpeg'"),$("#upload_image").val(""))):alert("Select file to upload!")}),$(".crop_image").click(function(a){$image_crop.croppie("result",{type:"canvas",format:"jpeg",quality:"1",size:{width:600,height:600}}).then(function(a){t=a,$("#blah").attr("src",a),$("#uploadimageModal").modal("hide"),$("#ModalInput").modal("show")})}),$(".btnAdd").on("click",function(){$("#formModalLabel").html("Save"),$("#register").val(o),$("#formModalLabel").html("Add new user"),$(".modal-footer button[type=btnS]").html("Save"),$(".modal-footer button[type=btn]").attr("id","buttonSave")}),$(document).on("click",".modal-footer button[id=buttonSave]",function(){var s={};s.register=o,s.name=$("#name").val(),s.email=$("#email").val(),s.password=$("#password").val(),s.image=t,s.img_name=e,s.img_ext=l,d(i+"/post","POST",s),r(a.status)}),$("#Check").click(function(){1==$("#Check").is(":checked")?($("#password").show(),$("#passwordLabel").show(),$("#passwordLabel").html("New Password")):($("#password").hide(),$("#passwordLabel").hide(),$("#password").val(""))}),$(document).on("click",".btnEdit",function(){$("#checkBtn").show(),$("#password").hide(),$("#passwordLabel").hide(),$("#formModalLabel").html("Edit"),$(".modal-footer button[type=btn]").html("Edit"),$(".modal-footer button[type=btn]").attr("id","buttonEdit");var t=this.id;d(i+"/getone/"+t,"GET");var e=a;if("success"==e.status){var l=e.data,o=l.avatar.split("/");$("#id").val(l.id),$("#register").val(l.register),$("#name").val(l.name),$("#email").val(l.email),$("#blah").attr("src","/phpmvc/"+l.thumbnail),$("#uploadId").val(o[2])}else alert(e.status)}),$(document).on("click",".modal-footer button[id=buttonEdit]",function(){var o={};if(o.id=$("#id").val(),o.name=$("#name").val(),o.email=$("#email").val(),1==$("#Check").is(":checked")&&(o.password=$("#password").val()),(""!==l||""!==e||""!==t)&&(d(i+"/getone/"+$("#id").val(),"get"),"success"==a.status)){var s=a.data;o.old_ava=s.avatar,o.old_thumb=s.thumbnail,o.image=t,o.img_name=e,o.img_ext=l}d(i+"/edit","put",o),r(a.status)}),$(document).on("click",".btnDetails",function(){$("#formModalLabel").html("Edit");var t=this.id;if(d(i+"/getone/"+t,"get"),"success"==a.status){var e=a.data;$("#ModalDetails #blah").attr("src","/phpmvc/"+e.thumbnail),$("#ModalDetails #register").text(e.register),$("#ModalDetails #name").text(e.name),$("#ModalDetails #email").text(e.email)}else alert(a.status)}),$(document).on("click",".btnDelete",function(){var t=this.id;if(1!=confirm("Want to delete?"))return!1;d(i+"/del/"+t,"delete"),r(a.status)}),$("#search").typeahead({items:10,scrollBar:!1,alignWidth:!0,ajax:{url:i+"/search",timeout:300,method:"get",triggerLength:1,loadingClass:null,preDispatch:null,preProcess:null},menu:' <ul class="typeahead dropdown-menu"></ul> ',item:'<li><a href="#" class="list-group-item list-group-item-action searchUser"></a></li>',valueField:"id",displayField:"data",autoSelect:!0,onSelect:function(t){$("#search").val(""),d(i+"/getone/"+t.value,"get");var e=a;if("success"==e.status)var l=e.data;$("#ModalDetails #blah").attr("src",l.thumbnail),$("#ModalDetails #register").text(l.register),$("#ModalDetails #name").text(l.name),$("#ModalDetails #email").text(l.email),$("#ModalDetails").modal("show")}}),function(){d(i+"/get","GET");var t=a;if("success"==t.status&&$.each(t.data,function(a,t){return data=$(".listUser").append('<li class="list-group-item">'+t.name+'<a href="#" id="'+t.id+'" class="badge badge-danger float-right ml-1 btnDelete"  >Delete</a><a href="#" id="'+t.id+'" class="badge badge-warning float-right ml-1 btnEdit" data-toggle="modal" data-target="#ModalInput"  > Edit</a><a href="#" id="'+t.id+'" class="badge badge-success float-right ml-1 btnDetails" data-toggle="modal" data-target="#ModalDetails" >Details</a></li>'),data}),"failed"==t.status)data=$(".listUser").append('<li class="list-group-item"> Empty'),data}()});